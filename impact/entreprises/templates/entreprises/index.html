{% extends "base.html" %}

{% load filters %}

{% block content %}
<div class="fr-container fr-my-8w">
    <h1>Mes entreprises</h1>
    {% if not user.entreprise_set.all %}
        Aucune entreprise n'est associée à votre compte.
    {% else %}
    <div class="fr-grid-row fr-mb-1w fr-grid-row--gutters">

        {% for entreprise in user.entreprise_set.all %}
        {% with habilitation=user|habilitation:entreprise %}
        <div class="fr-col fr-col-md-6">
            <div class="fr-card fr-card--md fr-card--shadow">
                <div class="fr-card__body">
                    <div class="fr-card__content">
                        <h3 class="fr-card__title">
                            {% if entreprise.denomination %}{{ entreprise.denomination }}{% else %}{{ entreprise.siren}}{% endif %}
                            {% if habilitation and habilitation.is_confirmed %}
                                    <span class="fr-badge fr-badge--success">Habilité</span>
                            {% endif %}
                        </h3>
                        <p class="fr-card__desc">
                            {% if habilitation and habilitation.fonctions %}en tant que {{ habilitation.fonctions }}{% endif %} </br>
                            SIREN :<b> {{ entreprise.siren }} </b></br>
                            Effectif :<b> {% if entreprise.effectif %}{{ entreprise.get_effectif_display }} salariés{% else %}non renseigné{% endif %} </b></br>
                            Accord d'entreprise concernant la BDESE :<b> {{ entreprise.bdese_accord | translate_boolean }} </b></br>
                        </p>
                        <div class="fr-card__start">
                            <ul class="fr-tags-group">
                                <li>
                                    {% if habilitation and habilitation.is_confirmed %}
                                        <p class="fr-badge fr-badge--success">Habilité</p>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="fr-card__footer">
                        <ul class="fr-btns-group--md fr-btns-group--inline-reverse fr-btns-group--inline-lg">
                            <li>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="siren" value="{{ entreprise.siren }}">
                                    <button type="submit" name="action" value="detach" class="fr-btn fr-btn--secondary fr-btn--icon-left fr-icon-close-circle-line">Se retirer</button>
                                </form>
                            </li>
                            <li>
                                <a href="{% url 'reglementation' entreprise.siren %}" class="fr-btn fr-btn--icon-left fr-icon-eye-line">Voir les réglementations</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
            {% endwith %}
            {% endfor %}
    {% endif %}
    </div>


    <h2 class="fr-mt-4w">Ajouter une entreprise</h2>
    <form method="post">
        {% csrf_token %}
        <div id="svelte-search-entreprise">
            {% include 'snippets/siren_field.html' %}
        </div>
        {% include 'snippets/field.html' with field=form.fonctions %}
        <button type="submit" name="action" value="attach" class="fr-btn">Ajouter cette entreprise</button>
    </form>

</div>

<!-- page entreprises -->
{% endblock %}
